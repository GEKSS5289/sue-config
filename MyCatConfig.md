# ü•ßMycat1.6.7.3
> ## üíøÂÆâË£ÖÁéØÂ¢É:CentOS 7
> ## üö¨‰∏ãËΩΩ
> ## üì¶Ëß£Âéã
> ## üõ†ÈÖçÁΩÆ(server.xml)
> ## üõ†ÈÖçÁΩÆ(schema.xml)
> ## üçüÊ≥®ÊÑè(autopartition-long.txt)
> ## ‚öóÊµãËØï
## ü•Ñ‰∏ãËΩΩMycat1.6.7.3
 ###  ü§ù‰ΩúËÄÖÊèê‰æõ:[Mycat1.6.7.3](https://shushun.oss-cn-shenzhen.aliyuncs.com/software/Mycat-server-1.6.7.3-release-20190828135747-linux.tar.gz)
# üì¶Ëß£Âéã  
      tar -zxvf Mycat-server-1.6.7.3-release-20190828135747-linux.tar.gz -C /usr/local/
# üõ†ÈÖçÁΩÆ(server.xml)

      vim /usr/local/mycat/conf/server.xml
      
      server.xml:
         <?xml version="1.0" encoding="UTF-8"?>
         
         <!DOCTYPE mycat:server SYSTEM "server.dtd">
         <mycat:server xmlns:mycat="http://io.mycat/">
         	<system>
         	<property name="nonePasswordLogin">0</property> <!-- 0‰∏∫ÈúÄË¶ÅÂØÜÁ†ÅÁôªÈôÜ„ÄÅ1‰∏∫‰∏çÈúÄË¶ÅÂØÜÁ†ÅÁôªÈôÜ ,ÈªòËÆ§‰∏∫0ÔºåËÆæÁΩÆ‰∏∫1ÂàôÈúÄË¶ÅÊåáÂÆöÈªòËÆ§Ë¥¶Êà∑-->
         	<property name="useHandshakeV10">1</property>
         	<property name="useSqlStat">0</property>  <!-- 1‰∏∫ÂºÄÂêØÂÆûÊó∂ÁªüËÆ°„ÄÅ0‰∏∫ÂÖ≥Èó≠ -->
         	<property name="useGlobleTableCheck">0</property>  <!-- 1‰∏∫ÂºÄÂêØÂÖ®Âä†Áè≠‰∏ÄËá¥ÊÄßÊ£ÄÊµã„ÄÅ0‰∏∫ÂÖ≥Èó≠ -->
         		<property name="sqlExecuteTimeout">300</property>  <!-- SQL ÊâßË°åË∂ÖÊó∂ Âçï‰Ωç:Áßí-->
         		<property name="sequnceHandlerType">2</property>
         		<!--<property name="sequnceHandlerPattern">(?:(\s*next\s+value\s+for\s*MYCATSEQ_(\w+))(,|\)|\s)*)+</property>-->
         		<!--ÂøÖÈ°ªÂ∏¶ÊúâMYCATSEQ_ÊàñËÄÖ mycatseq_ËøõÂÖ•Â∫èÂàóÂåπÈÖçÊµÅÁ®ã Ê≥®ÊÑèMYCATSEQ_ÊúâÁ©∫Ê†ºÁöÑÊÉÖÂÜµ-->
         		<property name="sequnceHandlerPattern">(?:(\s*next\s+value\s+for\s*MYCATSEQ_(\w+))(,|\)|\s)*)+</property>
         	<property name="subqueryRelationshipCheck">false</property> <!-- Â≠êÊü•ËØ¢‰∏≠Â≠òÂú®ÂÖ≥ËÅîÊü•ËØ¢ÁöÑÊÉÖÂÜµ‰∏ã,Ê£ÄÊü•ÂÖ≥ËÅîÂ≠óÊÆµ‰∏≠ÊòØÂê¶ÊúâÂàÜÁâáÂ≠óÊÆµ .ÈªòËÆ§ false -->
               <!--  <property name="useCompression">1</property>--> <!--1‰∏∫ÂºÄÂêØmysqlÂéãÁº©ÂçèËÆÆ-->
                 <!--  <property name="fakeMySQLVersion">5.6.20</property>--> <!--ËÆæÁΩÆÊ®°ÊãüÁöÑMySQLÁâàÊú¨Âè∑-->
         	<!-- <property name="processorBufferChunk">40960</property> -->
         	<!-- 
         	<property name="processors">1</property> 
         	<property name="processorExecutor">32</property> 
         	 -->
                 <!--ÈªòËÆ§‰∏∫type 0: DirectByteBufferPool | type 1 ByteBufferArena | type 2 NettyBufferPool -->
         		<property name="processorBufferPoolType">0</property>
         		<!--ÈªòËÆ§ÊòØ65535 64K Áî®‰∫ésqlËß£ÊûêÊó∂ÊúÄÂ§ßÊñáÊú¨ÈïøÂ∫¶ -->
         		<!--<property name="maxStringLiteralLength">65535</property>-->
         		<!--<property name="sequnceHandlerType">0</property>-->
         		<!--<property name="backSocketNoDelay">1</property>-->
         		<!--<property name="frontSocketNoDelay">1</property>-->
         		<!--<property name="processorExecutor">16</property>-->
         		<!--
         			<property name="serverPort">8066</property> <property name="managerPort">9066</property> 
         			<property name="idleTimeout">300000</property> <property name="bindIp">0.0.0.0</property>
         			<property name="dataNodeIdleCheckPeriod">300000</property> 5 * 60 * 1000L; //ËøûÊé•Á©∫Èó≤Ê£ÄÊü•
         			<property name="frontWriteQueueSize">4096</property> <property name="processors">32</property> -->
         		<!--ÂàÜÂ∏ÉÂºè‰∫ãÂä°ÂºÄÂÖ≥Ôºå0‰∏∫‰∏çËøáÊª§ÂàÜÂ∏ÉÂºè‰∫ãÂä°Ôºå1‰∏∫ËøáÊª§ÂàÜÂ∏ÉÂºè‰∫ãÂä°ÔºàÂ¶ÇÊûúÂàÜÂ∏ÉÂºè‰∫ãÂä°ÂÜÖÂè™Ê∂âÂèäÂÖ®Â±ÄË°®ÔºåÂàô‰∏çËøáÊª§ÔºâÔºå2‰∏∫‰∏çËøáÊª§ÂàÜÂ∏ÉÂºè‰∫ãÂä°,‰ΩÜÊòØËÆ∞ÂΩïÂàÜÂ∏ÉÂºè‰∫ãÂä°Êó•Âøó-->
         		<property name="handleDistributedTransactions">0</property>
         		
         			<!--
         			off heap for merge/order/group/limit      1ÂºÄÂêØ   0ÂÖ≥Èó≠
         		-->
         		<property name="useOffHeapForMerge">0</property>
         
         		<!--
         			Âçï‰Ωç‰∏∫m
         		-->
                 <property name="memoryPageSize">64k</property>
         
         		<!--
         			Âçï‰Ωç‰∏∫k
         		-->
         		<property name="spillsFileBufferSize">1k</property>
         
         		<property name="useStreamOutput">0</property>
         
         		<!--
         			Âçï‰Ωç‰∏∫m
         		-->
         		<property name="systemReserveMemorySize">384m</property>
         
         
         		<!--ÊòØÂê¶ÈááÁî®zookeeperÂçèË∞ÉÂàáÊç¢  -->
         		<property name="useZKSwitch">false</property>
         
         		<!-- XA Recovery LogÊó•ÂøóË∑ØÂæÑ -->
         		<!--<property name="XARecoveryLogBaseDir">./</property>-->
         
         		<!-- XA Recovery LogÊó•ÂøóÂêçÁß∞ -->
         		<!--<property name="XARecoveryLogBaseName">tmlog</property>-->
         		<!--Â¶ÇÊûú‰∏∫ trueÁöÑËØù ‰∏•Ê†ºÈÅµÂÆàÈöîÁ¶ªÁ∫ßÂà´,‰∏ç‰ºöÂú®‰ªÖ‰ªÖÂè™ÊúâselectËØ≠Âè•ÁöÑÊó∂ÂÄôÂú®‰∫ãÂä°‰∏≠ÂàáÊç¢ËøûÊé•-->
         		<property name="strictTxIsolation">false</property>
         		
         		<property name="useZKSwitch">true</property>
         		
         	</system>
         	
         	<!-- ÂÖ®Â±ÄSQLÈò≤ÁÅ´Â¢ôËÆæÁΩÆ -->
         	<!--ÁôΩÂêçÂçïÂèØ‰ª•‰ΩøÁî®ÈÄöÈÖçÁ¨¶%ÊàñÁùÄ*-->
         	<!--‰æãÂ¶Ç<host host="127.0.0.*" user="root"/>-->
         	<!--‰æãÂ¶Ç<host host="127.0.*" user="root"/>-->
         	<!--‰æãÂ¶Ç<host host="127.*" user="root"/>-->
         	<!--‰æãÂ¶Ç<host host="1*7.*" user="root"/>-->
         	<!--Ëøô‰∫õÈÖçÁΩÆÊÉÖÂÜµ‰∏ãÂØπ‰∫é127.0.0.1ÈÉΩËÉΩ‰ª•rootË¥¶Êà∑ÁôªÂΩï-->
         	<!--
         	<firewall>
         	   <whitehost>
         	      <host host="1*7.0.0.*" user="root"/>
         	   </whitehost>
                <blacklist check="false">
                </blacklist>
         	</firewall>
         	-->
         
         	<user name="root" defaultAccount="true">
         		<property name="password">ShuShun@1558</property>
         		<property name="schemas">user</property>
         		
         		<!-- Ë°®Á∫ß DML ÊùÉÈôêËÆæÁΩÆ -->
         		<!-- 		
         		<privileges check="false">
         			<schema name="TESTDB" dml="0110" >
         				<table name="tb01" dml="0000"></table>
         				<table name="tb02" dml="1111"></table>
         			</schema>
         		</privileges>		
         		 -->
         	</user>
         
         	<user name="user">
         		<property name="password">user</property>
         		<property name="schemas">user</property>
         		<property name="readOnly">true</property>
         	</user>
         
         </mycat:server>

# üõ†ÈÖçÁΩÆ(schema.xml)
       vim /usr/local/mycat/conf/schema.xml
        schema.xml:
            <?xml version="1.0"?>
            <!DOCTYPE mycat:schema SYSTEM "schema.dtd">
            <mycat:schema xmlns:mycat="http://io.mycat/">
            
            	<schema name="user" checkSQLschema="true" sqlMaxLimit="100">
            		<!-- auto sharding by id (long) -->
            		<table name="user" dataNode="dn154,dn155" rule="auto-sharding-long" />
            		</table>
            		<!-- <table name="oc_call" primaryKey="ID" dataNode="dn1$0-743" rule="latest-month-calldate"
            			/> -->
            	</schema>
            	<!-- <dataNode name="dn1$0-743" dataHost="localhost1" database="db$0-743"
            		/> -->
            	<dataNode name="dn154" dataHost="db154" database="user_154" />
            	<dataNode name="dn155" dataHost="db155" database="user_155" />
            	<!--<dataNode name="dn4" dataHost="sequoiadb1" database="SAMPLE" />
            	 <dataNode name="jdbc_dn1" dataHost="jdbchost" database="db1" />
            	<dataNode	name="jdbc_dn2" dataHost="jdbchost" database="db2" />
            	<dataNode name="jdbc_dn3" 	dataHost="jdbchost" database="db3" /> -->
            	<dataHost name="db154" maxCon="1000" minCon="10" balance="0"
            			  writeType="0" dbType="mysql" dbDriver="native" switchType="1"  slaveThreshold="100">
            		<heartbeat>select user()</heartbeat>
            		<!-- can have multi write hosts -->
            		<writeHost host="M1" url="192.168.182.154:3306" user="root"
            				   password="ShuShun@1558">
            			<!-- can have multi read hosts -->
            			<!--<readHost host="hostS2" url="192.168.1.200:3306" user="root" password="xxx" />-->
            		</writeHost>
            		<!-- <writeHost host="hostM2" url="localhost:3316" user="root" password="123456"/> -->
            	</dataHost>
            	<dataHost name="db155" maxCon="1000" minCon="10" balance="0"
                                      writeType="0" dbType="mysql" dbDriver="native" switchType="1"  slaveThreshold="100">
                            <heartbeat>select user()</heartbeat>
                            <!-- can have multi write hosts -->
                            <writeHost host="M1" url="192.168.182.155:3306" user="root"
                                               password="ShuShun@1558">
                                    <!-- can have multi read hosts -->
                                    <!--<readHost host="hostS2" url="192.168.1.200:3306" user="root" password="xxx" />-->
                            </writeHost>
                            <!-- <writeHost host="hostM2" url="localhost:3316" user="root" password="123456"/> -->
                    </dataHost>
            	<!--
            		<dataHost name="sequoiadb1" maxCon="1000" minCon="1" balance="0" dbType="sequoiadb" dbDriver="jdbc">
            		<heartbeat> 		</heartbeat>
            		 <writeHost host="hostM1" url="sequoiadb://1426587161.dbaas.sequoialab.net:11920/SAMPLE" user="jifeng" 	password="jifeng"></writeHost>
            		 </dataHost>
            
            	  <dataHost name="oracle1" maxCon="1000" minCon="1" balance="0" writeType="0" 	dbType="oracle" dbDriver="jdbc"> <heartbeat>select 1 from dual</heartbeat>
            		<connectionInitSql>alter session set nls_date_format='yyyy-mm-dd hh24:mi:ss'</connectionInitSql>
            		<writeHost host="hostM1" url="jdbc:oracle:thin:@127.0.0.1:1521:nange" user="base" 	password="123456" > </writeHost> </dataHost>
            
            		<dataHost name="jdbchost" maxCon="1000" 	minCon="1" balance="0" writeType="0" dbType="mongodb" dbDriver="jdbc">
            		<heartbeat>select 	user()</heartbeat>
            		<writeHost host="hostM" url="mongodb://192.168.0.99/test" user="admin" password="123456" ></writeHost> </dataHost>
            
            		<dataHost name="sparksql" maxCon="1000" minCon="1" balance="0" dbType="spark" dbDriver="jdbc">
            		<heartbeat> </heartbeat>
            		 <writeHost host="hostM1" url="jdbc:hive2://feng01:10000" user="jifeng" 	password="jifeng"></writeHost> </dataHost> -->
            
            	<!-- <dataHost name="jdbchost" maxCon="1000" minCon="10" balance="0" dbType="mysql"
            		dbDriver="jdbc"> <heartbeat>select user()</heartbeat> <writeHost host="hostM1"
            		url="jdbc:mysql://localhost:3306" user="root" password="123456"> </writeHost>
            		</dataHost> -->
            </mycat:schema>
# üçüÊ≥®ÊÑè(autopartition-long.txt)
    Â∞Ü1000M-1500MÊ≥®ÈáäÊéâ
        # range start-end ,data node index
        # K=1000,M=10000.
        0-500M=0
        500M-1000M=1
        #1000M-1500M=2
# üëçÁâπÂà´Ê≥®ÊÑè
    ÂÖ≥‰∫éÂØÜÁ†ÅÁ≠ñÁï•mysqlËÆæÁΩÆÂØÜÁ†ÅÁöÑÊó∂ÂÄôÈÄâÊã©ÊóßÁâàÊú¨ÁöÑÂä†ÂØÜÊñπÂºè:
        ALTER USER 'root'@'%' IDENTIFIED WITH mysql_native_password BY 'ShuShun@1558';
    mysql8cliËøûÊé•mycatÁöÑÊó∂ÂÄôÈÄâÊã©ÊóßÁâàÁöÑÂä†ÂØÜÁ≠ñÁï•:
        mysql -uroot -p -P8066 --default-auth=mysql_native_password